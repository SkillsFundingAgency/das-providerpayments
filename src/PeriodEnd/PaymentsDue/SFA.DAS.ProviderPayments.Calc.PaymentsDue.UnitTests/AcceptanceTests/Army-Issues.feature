Feature: Army-Issues
	Background: 
		Given The collection period is 1718-R14

@mytag
Scenario: Army learner should be correctly paid
	Given I have the following datalocks for provider 10033440
		| Ukprn    | PriceEpisodeIdentifier | LearnRefNumber | AimSeqNumber | CommitmentId | VersionId   | Period | Payable | TransactionType | TransactionTypesFlag |
		| 10033440 | 3-537-1-01/08/2018     | ITCC30282944   | 2            | 266784       | 4098748-001 | 1      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 1      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 2      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 3      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 4      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 5      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 6      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 7      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 8      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 9      | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 10     | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 11     | 1       | 0               | 1                    |
		| 10033440 | 3-537-1-29/09/2017     | ITCC30282944   | 2            | 266784       | 4098748-001 | 12     | 1       | 0               | 1                    |

	And I have the following datalock errors for provider 10033440
		| Ukprn    | LearnRefNumber | AimSeqNumber | RuleId   | PriceEpisodeIdentifier |
	
	And I have the following previous payments for provider 10033440
		| CommitmentId | CommitmentVersionId | AccountId | AccountVersionId | Uln        | LearnRefNumber | AimSeqNumber | Ukprn    | PriceEpisodeIdentifier | StandardCode | ProgrammeType | FrameworkCode | PathwayCode | ApprenticeshipContractType | DeliveryMonth | DeliveryYear | CollectionPeriodName | TransactionType | AmountDue | SfaContributionPercentage | FundingLineType                                  | UseLevyBalance | LearnAimRef | LearningStartDate       |
		| 266784       | 2454680-001         | 279       | 20180705         | 1316708828 | ITCC30282944   | 2            | 10033440 | 3-537-1-29/09/2017     | NULL         | 3             | 537           | 1           | 1                          | 6             | 2018         | 1718-R11             | 1               | 63.15789  | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | 1              | ZPROG001    | 2017-09-29 00:00:00.000 |
		| 266784       | 2853019-001         | 279       | 20180806         | 1316708828 | ITCC30282944   | 2            | 10033440 | 3-537-1-29/09/2017     | NULL         | 3             | 537           | 1           | 1                          | 7             | 2018         | 1718-R12             | 1               | 63.15789  | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | 1              | ZPROG001    | 2017-09-29 00:00:00.000 |
		| 266784       | 2454680-001         | 279       | 20180705         | 1316708828 | ITCC30282944   | 2            | 10033440 | 3-537-1-29/09/2017     | NULL         | 3             | 537           | 1           | 1                          | 5             | 2018         | 1718-R11             | 1               | 63.15789  | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | 1              | ZPROG001    | 2017-09-29 00:00:00.000 |
		| 266784       | 3151871-001         | 279       | 20180906         | 1316708828 | ITCC30282944   | 2            | 10033440 | 3-537-1-01/08/2018     | NULL         | 3             | 537           | 1           | 1                          | 8             | 2018         | 1819-R01             | 1               | 63.15790  | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | 1              | ZPROG001    | 2017-09-29 00:00:00.000 |
		| 266784       | 3624523-001         | 279       | 20181004         | 1316708828 | ITCC30282944   | 2            | 10033440 | 3-537-1-01/08/2018     | NULL         | 3             | 537           | 1           | 1                          | 9             | 2018         | 1819-R02             | 1               | 63.15790  | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | 1              | ZPROG001    | 2017-09-29 00:00:00.000 |
		
	And I have the following earnings for provider 10033440
		| LearnRefNumber | Ukprn    | AimSeqNumber | PriceEpisodeIdentifier | EpisodeStartDate | EpisodeEffectiveTNPStartDate | Period | Uln        | ProgrammeType | FrameworkCode | PathwayCode | StandardCode | SfaContributionPercentage | FundingLineType                                  | LearnAimRef | LearningStartDate | TransactionType01 | TransactionType02 | TransactionType03 | TransactionType04 | TransactionType05 | TransactionType06 | TransactionType07 | TransactionType08 | TransactionType09 | TransactionType10 | TransactionType11 | TransactionType12 | TransactionType13 | TransactionType14 | TransactionType15 | ApprenticeshipContractType |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-01/08/2018     | 2018-08-01       | 2017-09-29                   | 1      | 1316708828 | 3             | 537           | 1           | 0            | 0.00000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 1      | 1316708828 | 3             | 537           | 1           | 0            | 0.00000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 2      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 3      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 4      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 5      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 6      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 7      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 8      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 9      | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 10     | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 11     | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
		| ITCC30282944   | 10033440 | 2            | 3-537-1-29/09/2017     | 2017-09-29       | 2017-09-29                   | 12     | 1316708828 | 3             | 537           | 1           | 0            | 0.90000                   | 19+ Apprenticeship (From May 2017) Levy Contract | ZPROG001    | 2017-09-29        | 63.15789          | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0.00000           | 0                 | 0                 | 0.00000           | 1                          |
	
	And I have the following commitments for provider 10033440
		| Uln        | Ukprn    | CommitmentId | CommitmentVersionId | AccountId | AccountVersionId | StartDate  | EndDate    | AgreedCost | StandardCode | ProgrammeType | FrameworkCode | PathwayCode | PaymentStatus | Priority | EffectiveFrom | EffectiveTo | LegalEntityName | TransferSendingEmployerAccountId | TransferApprovalDate | IsLevyPayer |
		| 1316708828 | 10033440 | 266784       | 4098748-001         | 279       | 20181018         | 2017-09-01 | 2019-03-01 | 1500.00    | 0            | 3             | 537           | 1           | 1             | 15322    | 2017-09-01    | NULL        | British Army    | NULL                             | NULL                 | 1           |

	When I process period end
	Then The sum of the payments for learner 1316708828 should be 694.73679
	And The sum of the transaction type 1 payments for learner 1316708828 should be 694.73679
